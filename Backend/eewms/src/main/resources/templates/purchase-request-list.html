<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/common-head :: commonHead('Danh sách yêu cầu mua hàng')}"></head>
<body class="bg-gray-100 font-sans">
<div class="flex h-screen">
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <main id="mainContent" class="flex-1 ml-64 transition-all duration-300 relative">
        <div th:replace="~{fragments/header :: header}"></div>

        <section class="p-6">
            <div class="mb-6 flex items-center justify-between">
                <h1 class="text-2xl font-bold">Danh sách yêu cầu mua hàng</h1>

                <form sec:authorize="hasAnyRole('MANAGER','STAFF')"
                      th:action="@{/admin/purchase-requests/generate-all}" method="post" class="inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <a class="bg-blue-600 text-white px-4 py-2 rounded"
                       th:href="@{/admin/purchase-requests/collect}">
                        + Tạo yêu cầu mua (tổng hợp)
                    </a>
                </form>
            </div>

            <!-- Tìm kiếm / lọc -->
            <form method="get" class="mb-4 flex items-center space-x-2">
                <input type="text" name="keyword" placeholder="Tìm theo mã hoặc người tạo"
                       th:value="${keyword}" class="border px-3 py-2 rounded w-1/3"/>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Tìm kiếm</button>
            </form>

            <form method="get" class="mb-6 flex flex-wrap items-center gap-4">
                <input type="text" name="creator" placeholder="Người tạo"
                       th:value="${creator}" class="border px-3 py-2 rounded"/>
                <input type="date" name="startDate" th:value="${startDate}" class="border px-3 py-2 rounded"/>
                <span>–</span>
                <input type="date" name="endDate" th:value="${endDate}" class="border px-3 py-2 rounded"/>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Lọc</button>
            </form>

            <!-- Thông báo -->
            <div th:if="${message}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-4">
                <i class="ri-check-line mr-1"></i><span th:text="${message}"></span>
            </div>
            <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4">
                <i class="ri-error-warning-line mr-1"></i><span th:text="${error}"></span>
            </div>

            <!-- Danh sách -->
            <!-- Danh sách -->
            <div th:if="${requestPage.totalElements == 0}" class="text-gray-500 italic">Không có yêu cầu nào.</div>

            <div th:if="${requestPage.totalElements > 0}">
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table id="Table" class="min-w-full table-auto text-sm border border-gray-200">
                        <thead class="bg-gray-100 text-left">
                        <tr>
                            <th class="px-4 py-3 border border-gray-200 font-semibold">Mã yêu cầu</th>
                            <th class="px-4 py-3 border border-gray-200 font-semibold">Người tạo</th>
                            <th class="px-4 py-3 border border-gray-200 font-semibold">Ngày tạo</th>
                            <th class="px-4 py-3 border border-gray-200 font-semibold">Trạng thái</th>
                            <th class="px-4 py-3 border border-gray-200 font-semibold text-center">Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="request : ${requestPage.content}" class="border-t hover:bg-gray-50">
                            <td class="px-4 py-2 border border-gray-200" th:text="${request.code}">PR00001</td>
                            <td class="px-4 py-2 border border-gray-200" th:text="${request.createdByName}">Nguyễn Văn
                                A
                            </td>
                            <td class="px-4 py-2 border border-gray-200">
          <span th:if="${request.createdAt != null}"
                th:text="${#temporals.format(request.createdAt, 'dd/MM/yyyy HH:mm')}">01/08/2025</span>
                                <span th:if="${request.createdAt == null}">---</span>
                            </td>

                            <!-- Badge trạng thái -->
                            <td class="px-4 py-2 border border-gray-200 w-32">
          <span class="inline-flex items-center justify-center px-2 py-1 rounded text-md font-semibold whitespace-nowrap w-32"
                th:classappend="
            ${request.status?.name() == 'MOI_TAO'}  ? 'bg-gray-100  text-gray-700'  :
            (${request.status?.name() == 'DA_DUYET'} ? 'bg-emerald-100 text-emerald-700' :
            (${request.status?.name() == 'DA_TAO_PO'} ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'))"
                th:text="${request.status != null ? request.status.label : '---'}">
    </span>
                            </td>

                            <!-- Thao tác: 2 nút -->
                            <td class="px-4 py-2 border border-gray-200 text-center w-1">
                                <div class="inline-flex items-center gap-2">
                                    <!-- Nút Xem -->
                                    <a th:href="@{'/admin/purchase-requests/' + ${request.id}}"
                                       class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-800 border rounded hover:bg-gray-200 whitespace-nowrap shadow">
                                        <i class="ri-eye-line text-sm"></i> Chi tiết
                                    </a>


                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- Phân trang -->
                    <!--                    <div class="mt-4 flex justify-center space-x-2">-->
                    <!--                        <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"-->
                    <!--                           th:href="@{'/admin/purchase-requests'(page=${i}, creator=${creator}, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}"-->
                    <!--                           th:text="${i + 1}"-->
                    <!--                           th:class="'px-3 py-1 border rounded ' + (${i} == ${currentPage} ? 'bg-blue-600 text-white' : 'bg-white text-blue-600')">-->
                    <!--                        </a>-->
                    <!--                    </div>-->
                </div>
                <div th:replace="~{fragments/pagination :: clientPager('Table', 10)}"></div>
            </div>
        </section>
    </main>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
