<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common-head :: commonHead('Xem trước sản phẩm thiếu')}"></head>
<body class="bg-gray-100 font-sans">
<div class="flex h-screen">
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    <main id="mainContent" class="flex-1 ml-64 transition-all duration-300 relative">
        <div th:replace="~{fragments/header :: header}"></div>

        <section class="p-6 max-w-5xl">
            <h1 class="text-2xl font-bold mb-4">Sản phẩm thiếu (đơn đang mở)</h1>

            <form th:action="@{/admin/purchase-requests/create-from-collected}" method="post"
                  th:object="${requestDTO}">
                <!-- gói items vào DTO để submit -->
                <input type="hidden" name="_dummy"/>

                <table class="w-full table-auto border border-gray-300 mb-4">
                    <thead class="bg-gray-100">
                    <tr>
                        <th class="border p-2">Sản phẩm</th>
                        <th class="border p-2 w-40">Số lượng cần mua</th>
                        <th class="border p-2 w-72">Nhà cung cấp gợi ý</th>
                        <th class="border p-2">Ghi chú</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="it, iStat : ${collectedItems}">
                        <td class="border p-2">
                            <span th:text="${it.productName}">SP</span>
                            <input type="hidden" th:name="'items[' + ${iStat.index} + '].productId'"
                                   th:value="${it.productId}"/>
                            <input type="hidden" th:name="'items[' + ${iStat.index} + '].productName'"
                                   th:value="${it.productName}"/>
                        </td>
                        <td class="border p-2">
                            <input type="number" min="1" class="w-full border rounded px-2 py-1"
                                   th:name="'items[' + ${iStat.index} + '].quantityNeeded'"
                                   th:value="${it.quantityNeeded}"/>
                        </td>
                        <td class="border p-2">
                            <select class="w-full border rounded px-2 py-1"
                                    th:name="'items[' + ${iStat.index} + '].suggestedSupplierId'">
                                <option value="">-- Không chọn --</option>
                                <option th:each="s : ${allowedSuppliers[ it.productId ]}"
                                        th:value="${s.id}" th:text="${s.name}"></option>
                            </select>
                        </td>
                        <td class="border p-2">
                            <input type="text" class="w-full border rounded px-2 py-1"
                                   th:name="'items[' + ${iStat.index} + '].note'"/>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="flex justify-end gap-3">
                    <a th:href="@{/admin/purchase-requests}"
                       class="px-4 py-2 border rounded text-gray-700">Huỷ</a>
                    <button type="submit"
                            class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white">
                        Xác nhận tạo yêu cầu
                    </button>
                </div>
            </form>
        </section>
    </main>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
