<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/common-head :: commonHead('Danh sách nhà cung cấp')}"></head>
<body class="bg-gray-100 font-sans">
<div class="flex h-screen">
    <!-- Sidebar -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <!-- Main content -->
    <main id="mainContent" class="flex-1 ml-64 transition-all duration-300 relative">
        <!-- Header -->
        <div th:replace="~{fragments/header :: header}"></div>

        <!-- Page Title + Button -->
        <div class="flex justify-between items-center mb-4 px-6 py-6">
            <h1 class="text-2xl font-bold text-gray-800">Danh sách nhà cung cấp</h1>
            <div class="flex items-center gap-2">
                <form th:action="@{/admin/suppliers}" method="get" class="flex gap-2">
                    <input type="text" name="keyword" th:value="${keyword}" placeholder="Tìm theo tên, mã số thuế..."
                           class="border px-3 py-2 rounded-md w-64"/>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Tìm
                    </button>
                </form>
                <button sec:authorize="hasAnyRole('MANAGER','STAFF')"
                        id="openAddModal" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                    <i class="ri-add-line mr-1"></i> Thêm mới
                </button>
            </div>
        </div>


        <!-- Supplier Table -->
        <div class="px-6 py-6">
            <div class="bg-white rounded-lg shadow">
                <table id="Table" class="min-w-full table-auto text-sm border border-gray-200">
                    <thead class="bg-gray-100 text-left">
                    <tr>
                        <th class="px-4 py-3 font-semibold border border-gray-200">STT</th>
                        <th class="px-4 py-3 font-semibold border border-gray-200 w-64">Tên NCC</th>
                        <th class="hidden px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap">Mã số thuế
                        </th>
                        <th class="hidden px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap">Ngân hàng
                        </th>
                        <th class="hidden px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap">Số tài
                            khoản
                        </th>
                        <th class="px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap">Người liên hệ</th>
                        <th class="px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap">SĐT</th>
                        <th class="px-4 py-3 font-semibold border border-gray-200 whitespace-nowrap text-center">Trạng thái</th>
                        <!--                    <th class="px-4 py-3 font-semibold">Ghi Chú</th>-->
                        <th class="px-4 py-3 font-semibold border border-gray-200 text-center whitespace-nowrap">Hành
                            động
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="supplier, iterStat : ${suppliers}"
                        class="border-t hover:bg-gray-50">
                        <td class="px-4 py-2 border border-gray-200 w-1" th:text="${supplier.id}"></td>
                        <td class="px-4 py-2 border border-gray-200" th:text="${supplier.name}"></td>
                        <td class="hidden px-4 py-2 border border-gray-200" th:text="${supplier.taxCode}"></td>
                        <td class="hidden px-4 py-2 border border-gray-200" th:text="${supplier.bankName}"></td>
                        <td class="hidden px-4 py-2 border border-gray-200" th:text="${supplier.bankAccount}"></td>
                        <td class="px-4 py-2 border border-gray-200 w-1" th:text="${supplier.contactName}"></td>
                        <td class="px-4 py-2 border border-gray-200 w-1" th:text="${supplier.contactMobile}"></td>
                        <td class="px-4 py-2 border border-gray-200 w-1">
                            <div class="flex items-center justify-center gap-3">
                            <span class="inline-flex items-center justify-center w-32 px-2 py-1 rounded text-xs font-medium whitespace-nowrap"
                                  th:classappend="${supplier.status} ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                                  th:text="${supplier.status} ? 'Đang hoạt động' : 'Ngưng hoạt động'">
                            </span>
                                <form sec:authorize="hasAnyRole('MANAGER','STAFF')"
                                      th:action="@{'/admin/suppliers/toggle/' + ${supplier.id}}" method="post"
                                      class="status-toggle-form" th:data-id="${supplier.id}">
                                    <label class="inline-flex items-center cursor-pointer relative">
                                        <input type="checkbox" name="status"
                                               th:checked="${supplier.status}"
                                               onchange="this.form.submit()" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors duration-300"></div>
                                        <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5"></div>
                                    </label>
                                </form>
                            </div>
                        </td>
                        <!--                    <td class="px-4 py-2" th:text="${supplier.description}"></td>-->
                        <td class="px-4 py-2 text-center w-1">
                            <div class="inline-flex items-center gap-2">
                                <a href="#"
                                   sec:authorize="hasRole('ADMIN')"
                                   class="inline-flex items-center justify-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-800 border rounded hover:bg-gray-200 text-sm whitespace-nowrap"
                                   onclick="openDetailModal(this)"
                                   th:data-id="${supplier.id}"
                                   th:data-name="${supplier.name}"
                                   th:data-taxcode="${supplier.taxCode}"
                                   th:data-bankname="${supplier.bankName}"
                                   th:data-bankaccount="${supplier.bankAccount}"
                                   th:data-contactname="${supplier.contactName}"
                                   th:data-contactmobile="${supplier.contactMobile}"
                                   th:data-address="${supplier.address}"
                                   th:data-description="${supplier.description}">
                                    <i class="ri-eye-line"></i><span>Chi tiết</span>
                                </a>

                                <a sec:authorize="hasAnyRole('MANAGER','STAFF')"
                                        type="button"
                                        class="inline-flex items-center justify-center gap-1 px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded whitespace-nowrap shadow"
                                        onclick="showEditModal(this)"
                                        th:data-id="${supplier.id}"
                                        th:data-name="${supplier.name}"
                                        th:data-taxcode="${supplier.taxCode}"
                                        th:data-bankname="${supplier.bankName}"
                                        th:data-bankaccount="${supplier.bankAccount}"
                                        th:data-contactname="${supplier.contactName}"
                                        th:data-contactmobile="${supplier.contactMobile}"
                                        th:data-address="${supplier.address}"
                                        th:data-status="${supplier.status} == true ? 'true' : 'false'"


                                        th:data-description="${supplier.description}">
                                        <i class="ri-pencil-line"> </i>
                                    Sửa
                                </a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <!-- Pagination -->
                <!--                <div class="flex justify-center mt-6">-->
                <!--                    <ul class="inline-flex space-x-1">-->
                <!--                        &lt;!&ndash; Nút về đầu &ndash;&gt;-->
                <!--                        <li th:if="${supplierPage.totalPages > 1}">-->
                <!--                            <a th:href="@{/admin/suppliers(page=0, keyword=${keyword})}"-->
                <!--                               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">«</a>-->
                <!--                        </li>-->

                <!--                        &lt;!&ndash; Nút về trước &ndash;&gt;-->
                <!--                        <li th:if="${supplierPage.hasPrevious()}">-->
                <!--                            <a th:href="@{/admin/suppliers(page=${supplierPage.number - 1}, keyword=${keyword})}"-->
                <!--                               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">‹</a>-->
                <!--                        </li>-->

                <!--                        &lt;!&ndash; Các số trang &ndash;&gt;-->
                <!--                        <li th:each="i : ${#numbers.sequence(0, supplierPage.totalPages - 1)}">-->
                <!--                            <a th:href="@{/admin/suppliers(page=${i}, keyword=${keyword})}"-->
                <!--                               th:text="${i + 1}"-->
                <!--                               th:classappend="${supplierPage.number == i} ? 'bg-blue-600 text-white' : 'bg-gray-200 hover:bg-gray-300'"-->
                <!--                               class="px-3 py-1 rounded text-sm font-medium"></a>-->
                <!--                        </li>-->

                <!--                        &lt;!&ndash; Nút tiếp theo &ndash;&gt;-->
                <!--                        <li th:if="${supplierPage.hasNext()}">-->
                <!--                            <a th:href="@{/admin/suppliers(page=${supplierPage.number + 1}, keyword=${keyword})}"-->
                <!--                               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">›</a>-->
                <!--                        </li>-->

                <!--                        &lt;!&ndash; Nút đến cuối &ndash;&gt;-->
                <!--                        <li>-->
                <!--                            <a th:href="@{/admin/suppliers(page=${supplierPage.totalPages - 1}, keyword=${keyword})}"-->
                <!--                               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">»</a>-->
                <!--                        </li>-->
                <!--                    </ul>-->
                <!--                </div>-->
            </div>
            <div th:replace="~{fragments/pagination :: clientPager('Table', 10)}"></div>
        </div>
        <!-- ✅ Modal Thêm nhà cung cấp -->
        <div id="addSupplierModal"
             class="fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center"
             th:classappend="${hasFormError} ? '' : ' hidden'">
            <div class="bg-white rounded-lg shadow-md w-full max-w-2xl">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-lg font-semibold text-gray-700">Thêm nhà cung cấp</h2>
                    <button onclick="closeAddModal()" class="text-gray-500 hover:text-gray-800 text-xl">&times;</button>
                </div>
                <form th:action="@{/admin/suppliers}" method="post" th:object="${newSupplier}" class="p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tên nhà cung cấp</label>
                            <input type="text" th:field="*{name}" id="name"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('name')}"
                               th:errors="*{name}"></p>
                        </div>
                        <!--                        <div>-->
                        <!--                            <label class="block text-sm font-medium text-gray-700">Mã số thuế</label>-->
                        <!--                            <input type="text" th:field="*{taxCode}"-->
                        <!--                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">-->
                        <!--                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('taxCode')}"-->
                        <!--                               th:errors="*{taxCode}"></p>-->
                        <!--                        </div>-->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Mã số thuế
                                <span id="taxLoading" class="ml-2 text-xs text-gray-500 hidden">Đang tra…</span>
                            </label>
                            <div class="mt-1 flex gap-2">
                                <input type="text" th:field="*{taxCode}" id="taxCode"
                                       class="w-full border rounded px-3 py-2 text-sm">
                                <button type="button" id="btnFetchTax"
                                        class="px-3 py-2 bg-gray-100 rounded border text-sm">Lấy
                                </button>
                            </div>
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('taxCode')}"
                               th:errors="*{taxCode}"></p>
                        </div>
                        <!--                        <div>-->
                        <!--                            <label class="block text-sm font-medium text-gray-700">Ngân hàng</label>-->
                        <!--                            <input type="text" th:field="*{bankName}"-->
                        <!--                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">-->
                        <!--                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('bankName')}"-->
                        <!--                               th:errors="*{bankName}"></p>-->
                        <!--                        </div>-->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ngân hàng</label>
                            <div class="mt-1 relative">
                                <input type="text" th:field="*{bankName}" id="bankNameInput" autocomplete="off"
                                       class="w-full border rounded px-3 py-2 text-sm"
                                       placeholder="Gõ mã/tên ngân hàng...">
                                <div id="bankSuggest"
                                     class="absolute z-50 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto hidden"></div>
                            </div>
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('bankName')}"
                               th:errors="*{bankName}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số tài khoản</label>
                            <input type="text" th:field="*{bankAccount}"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('bankAccount')}"
                               th:errors="*{bankAccount}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Người liên hệ</label>
                            <input type="text" th:field="*{contactName}"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1"
                               th:if="${#fields.hasErrors('contactName')}"
                               th:errors="*{contactName}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số điện thoại</label>
                            <input type="text" th:field="*{contactMobile}"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('contactMobile')}"
                               th:errors="*{contactMobile}"></p>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Địa chỉ</label>
                            <input type="text" th:field="*{address}" id="address"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1"
                               th:if="${#fields.hasErrors('address')}"
                               th:errors="*{address}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ghi chú</label>
                            <input type="text" th:field="*{description}"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1"
                               th:if="${#fields.hasErrors('description')}"
                               th:errors="*{description}"></p>
                        </div>

                    </div>
                    <div class="flex justify-end mt-4 space-x-2">
                        <button type="button" onclick="closeAddModal()"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm">
                            Đóng
                        </button>
                        <button type="submit"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                            Lưu
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ✅ Modal Sửa nhà cung cấp -->
        <div id="editSupplierModal"
             class="fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center"
             th:classappend="${hasEditError} ? '' : ' hidden'">
            <div class="bg-white rounded-lg shadow-md w-full max-w-2xl">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-lg font-semibold text-gray-700">Chỉnh sửa nhà cung cấp</h2>
                    <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-800 text-xl">&times;
                    </button>
                </div>
                <form th:action="@{/admin/suppliers/update}" method="post" th:object="${editSupplier}"
                      id="editSupplierForm" class="p-6 space-y-4" data-mode="edit">
                    <input type="hidden" th:field="*{id}" id="editId"/>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tên nhà cung cấp</label>
                            <input type="text" th:field="*{name}" id="editName"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('name')}"
                               th:errors="*{name}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Mã số thuế
                                <span id="editTaxLoading" class="ml-2 text-xs text-gray-500 hidden">Đang tra…</span>
                            </label>
                            <div class="mt-1 flex gap-2">
                                <input type="text" th:field="*{taxCode}" id="editTaxCode"
                                       class="w-full border rounded px-3 py-2 text-sm">
                                <button type="button" id="btnFetchTaxEdit"
                                        class="px-3 py-2 bg-gray-100 rounded border text-sm">Lấy
                                </button>
                            </div>
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('taxCode')}"
                               th:errors="*{taxCode}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ngân hàng</label>
                            <div class="mt-1 relative">
                                <input type="text" th:field="*{bankName}" id="editBankNameInput" autocomplete="off"
                                       class="w-full border rounded px-3 py-2 text-sm"
                                       placeholder="Gõ mã/tên ngân hàng...">
                                <div id="editBankSuggest"
                                     class="absolute z-50 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto hidden"></div>
                            </div>
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('bankName')}"
                               th:errors="*{bankName}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số tài khoản</label>
                            <input type="text" th:field="*{bankAccount}" id="editBankAccount"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('bankAccount')}"
                               th:errors="*{bankAccount}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Người liên hệ</label>
                            <input type="text" th:field="*{contactName}" id="editContactName"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('contactName')}"
                               th:errors="*{contactName}"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số điện thoại</label>
                            <input type="text" th:field="*{contactMobile}" id="editContactMobile"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1" th:if="${#fields.hasErrors('contactMobile')}"
                               th:errors="*{contactMobile}"></p>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Địa chỉ</label>
                            <input type="text" th:field="*{address}" id="editAddress"
                                   class="mt-1 w-full border rounded px-3 py-2 text-sm">
                            <p class="text-red-500 text-xs italic mt-1"
                               th:if="${#fields.hasErrors('address')}"
                               th:errors="*{address}"></p>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Ghi chú</label>
                            <textarea th:field="*{description}" id="editDescription"
                                      class="mt-1 w-full border rounded px-3 py-2 text-sm"
                                      rows="3"></textarea>
                            <p class="text-red-500 text-xs italic mt-1"
                               th:if="${#fields.hasErrors('description')}"
                               th:errors="*{description}"></p>
                        </div>
                    </div>
                    <div class="flex justify-end mt-4 space-x-2">
                        <button type="button" onclick="closeEditModal()"
                                id="btnEditClose"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm">
                            Hủy
                        </button>
                        <button sec:authorize="hasAnyRole('MANAGER','STAFF')"
                                type="submit"
                                id="btnEditSave"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                            Lưu thay đổi
                        </button>
                    </div>
                </form>
            </div>
        </div>


    </main>
</div>
<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script th:inline="javascript">
    // ================= Helpers chung =================
    function clearFieldErrors(scope) {
        scope.querySelectorAll('.text-red-500, [data-field-error]').forEach(el => el.textContent = '');
    }

    function resetFormAndHide(modalId, redirectPath) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        const form = modal.querySelector('form');
        if (form) {
            form.reset();
            clearFieldErrors(form);
        }
        modal.classList.add('hidden');
        window.location.href = redirectPath;
    }

    // ================= Readonly helper (NEW) =================
    function setFormReadonly(isReadonly) {
        const form = document.getElementById('editSupplierForm');
        if (!form) return;

        const btnSave = document.getElementById('btnEditSave');
        const btnClose = document.getElementById('btnEditClose');

        form.querySelectorAll('input, select, textarea').forEach(el => {
            if (el.type === 'hidden') return;
            el.disabled = isReadonly;
            el.classList.toggle('bg-gray-100', isReadonly);
            el.classList.toggle('cursor-not-allowed', isReadonly);
        });

        if (btnSave) btnSave.classList.toggle('hidden', isReadonly);
        if (btnClose) btnClose.textContent = isReadonly ? 'Đóng' : 'Thoát';

        form.dataset.mode = isReadonly ? 'detail' : 'edit';
    }

    // ================= ADD modal =================
    const openAddBtn = document.getElementById('openAddModal');
    if (openAddBtn) {
        openAddBtn.addEventListener('click', () => {
            document.getElementById('addSupplierModal').classList.remove('hidden');
        });
    }

    function closeAddModal() {
        resetFormAndHide('addSupplierModal', '/admin/suppliers');
    }

    // ================= EDIT modal =================
    // MỞ từ nút Sửa: fill từ data-* (case bình thường, KHÔNG có lỗi server)
    function showEditModal(button) {
        const editModal = document.getElementById('editSupplierModal');

        const hasEditError = /*[[${hasEditError}]]*/ false;
        if (!hasEditError) {
            document.getElementById('editId').value = button.dataset.id || '';
            document.getElementById('editName').value = button.dataset.name || '';
            document.getElementById('editTaxCode').value = button.dataset.taxcode || '';
            document.getElementById('editBankNameInput').value = button.dataset.bankname || '';
            document.getElementById('editBankAccount').value = button.dataset.bankaccount || '';
            document.getElementById('editContactName').value = button.dataset.contactname || '';
            document.getElementById('editContactMobile').value = button.dataset.contactmobile || '';
            document.getElementById('editAddress').value = button.dataset.address || '';
            document.getElementById('editDescription').value = button.dataset.description || '';
        }

        // luôn về EDIT khi mở sửa
        setFormReadonly(false);

        // Đổi tiêu đề về sửa
        const title = editModal.querySelector('h2');
        if (title) title.textContent = 'Chỉnh sửa nhà cung cấp';

        editModal.classList.remove('hidden');
    }

    function closeEditModal() {
        resetFormAndHide('editSupplierModal', '/admin/suppliers');
    }

    // ================= Xem chi tiết (readonly) (NEW) =================
    function openDetailModal(button) {
        // tái sử dụng luồng fill như sửa
        showEditModal(button);

        // bật readonly + đổi tiêu đề
        setFormReadonly(true);
        const title = document.querySelector('#editSupplierModal h2');
        if (title) title.textContent = 'Xem nhà cung cấp';
    }

    // ================= Chặn submit khi chế độ detail (NEW) =================
    (function () {
        const form = document.getElementById('editSupplierForm');
        if (!form) return;
        if (!form.dataset.mode) form.dataset.mode = 'edit';
        form.addEventListener('submit', function (e) {
            if (form.dataset.mode === 'detail') e.preventDefault();
        });
    })();

    // ================= Auto-open khi submit lỗi =================
    const hasFormError = /*[[${hasFormError}]]*/ false;
    if (hasFormError) {
        // nếu cần init autosuggest khi modal thêm đang mở, init ở đây
    }

    const hasEditError = /*[[${hasEditError}]]*/ false;
    if (hasEditError) {
        // khi có lỗi server bind, modal sửa sẽ mở lại và giữ dữ liệu
        document.getElementById('editSupplierModal').classList.remove('hidden');
        // đảm bảo ở chế độ EDIT để user sửa lỗi
        setFormReadonly(false);
    }

    // ================= User menu + alert như cũ =================
    document.addEventListener('DOMContentLoaded', () => {
        const alert = document.getElementById('alertSuccess');
        if (alert) setTimeout(() => alert.classList.add('hidden'), 3000);
    });
</script>

<script th:src="@{/assets/js/supplier-tax-lookup.js}"></script>
<script th:src="@{/assets/js/bank-select.js}"></script>
</body>
</html>





